#!/usr/bin/emacs --script
;;BOP
;;
;; !DESCRIPTION:
;;   Este script indenta e remove tabs de arquivos automaticamente usando Emacs.
;;   Ele √© √∫til para padronizar c√≥digo e arquivos de configura√ß√£o.
;;
;; !USAGE:
;;   Para rodar o script em um ou mais arquivos:
;;     ./indent arquivo1.c arquivo2.sh
;;   Para rodar em todos os arquivos de um diret√≥rio:
;;     find . -name "*.sh" | xargs ./indent
;;
;; !AUTHOR:
;;   Criado por J. G. de Mattos
;;
;; !REVISION HISTORY:
;;   05 fev 2025 - J. G. de Mattos - Vers√£o inicial
;;   06 fev 2025 - Melhorias na verifica√ß√£o de arquivos e mensagens de log
;;
;;EOP

(setq require-final-newline 'visit)  ;; Garante que o arquivo termina com uma nova linha

;;BOC
(defun indent-files (files)
  "Aplica indenta√ß√£o e formata√ß√£o em uma lista de FILES."
  (cond 
   (files
    (let ((file (car files))) 
      (if (file-exists-p file)
          (progn
            (message "üìÑ Processando: %s" file)
            (find-file file)
            (set-buffer-file-coding-system 'utf-8) ;; For√ßa UTF-8
            (untabify (point-min) (point-max))     ;; Converte tabs em espa√ßos
            (indent-region (point-min) (point-max)) ;; Aplica indenta√ß√£o autom√°tica
            (save-buffer)                          ;; Salva o arquivo
            (kill-buffer)                          ;; Fecha o buffer
            (message "‚úÖ Arquivo formatado: %s" file))
        (message "‚ùå Arquivo n√£o encontrado: %s" file)))
    (indent-files (cdr files))))) ;; Chamada recursiva para o pr√≥ximo arquivo
;;EOC

;; Executa a fun√ß√£o com os arquivos passados como argumentos
(indent-files command-line-args-left)

(message "üéØ Indenta√ß√£o conclu√≠da para todos os arquivos.")
;; EOF
